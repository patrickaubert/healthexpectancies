left_join(
#FRInseePopulationForecast2021 %>%
#  filter(geo=="france",type.obs=="observed",year<=2020) %>%
FRInseePopulation %>%
filter(geo=="france") %>%
mutate(year=year-1,
#sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   )
verif <- eff %>% group_by(annee,sexe,age) %>% filter(n()>1)
View(verif)
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
left_join(
#FRInseePopulationForecast2021 %>%
#  filter(geo=="france",type.obs=="observed",year<=2020) %>%
FRInseePopulation %>%
filter(geo=="france") %>%
mutate(year=year-1,
#sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   )
View(eff)
verif <- FRInseePopulationForecast2021  %>% count(year,type.obs)
View(verif)
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 99 ans
left_join(
FRInseePopulation %>%
filter(geo=="france") %>%
mutate(year=year-1,
#sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022) %>%
mutate(year=year-1,
#sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   )
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 99 ans
left_join(
FRInseePopulation %>%
filter(geo=="france") %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx0101,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   )
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 99 ans
left_join(
FRInseePopulation %>%
filter(geo=="france") %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx0101,age=age0101) %>%
select(annee,sexe,age,poptot_proj),
by=c("annee","sexe","age")   )
View(eff)
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 98 ans (la valeur 99 correspond aux 99 et +)
left_join(
FRInseePopulation %>%
filter(geo=="france" & age < 99) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx0101,age=age0101) %>%
select(annee,sexe,age,poptot_proj),
by=c("annee","sexe","age")   )
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 98 ans (la valeur 99 correspond aux 99 et +)
left_join(
FRInseePopulation %>%
filter(geo=="france" & age0101 < 99) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx0101,age=age0101) %>%
select(annee,sexe,age,poptot_proj),
by=c("annee","sexe","age")   )
View(eff)
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 98 ans (la valeur 99 correspond aux 99 et +)
left_join(
FRInseePopulation %>%
filter(geo=="france" & age0101 < 99) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés (la valeur 105 correspond aux 105 et +)
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022, age < 105) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx0101,age=age0101) %>%
select(annee,sexe,age,poptot_proj),
by=c("annee","sexe","age")   )
eff <- bind_rows(eff0711, eff1519, eff1923) %>%
arrange(annee,sexe,age) %>%
distinct() %>% # pour éliminer doublon année 2019
# ~~~~  table FRInseePopulation -> uniquement les âges jusqu'à 98 ans (la valeur 99 correspond aux 99 et +)
left_join(
FRInseePopulation %>%
filter(geo=="france" & age0101 < 99) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("M"="hommes","F"="femmes")) %>%
rename(sexe=sex,annee=year,poptot=popx,age=age0101) %>%
select(annee,sexe,age,poptot),
by=c("annee","sexe","age")   ) %>%
# ~~~~  table des projections de population = y compris âges plus élevés (la valeur 105 correspond aux 105 et +)
left_join(
FRInseePopulationForecast2021 %>%
filter(geo=="france",type.obs=="observed" | year>2022, age0101 < 105) %>%
mutate(year=year-1,
sex = as.character(sex) %>% recode("male"="hommes","female"="femmes")) %>%
rename(sexe=sex,annee=year,poptot_proj=popx0101,age=age0101) %>%
select(annee,sexe,age,poptot_proj),
by=c("annee","sexe","age")   )
names(eff)
FRDreesEHPA <- bind_rows(
eff,
eff %>%
select(-sexe) %>%
group_by(annee,age) %>% summarise_all(sum, na.rm=TRUE) %>% ungroup() %>%
mutate(sexe="ensemble")
) %>%
mutate(prevalence=nb/ifelse(!is.na(poptot),poptot,poptot_proj) )  %>%
select(-poptot_proj) %>%
rename(sex=sexe,year=annee) %>%
mutate(sex = sex %>% recode("ensemble"="all","femmes"="female","hommes"="male"))
View(FRDreesEHPA)
FRDreesEHPA <- bind_rows(
eff,
eff %>%
select(-sexe) %>%
group_by(annee,age) %>% summarise_all(sum, na.rm=TRUE) %>% ungroup() %>%
mutate(sexe="ensemble")
) %>%
mutate(prevalence=case_when(
!is.na(poptot) ~ nb/poptot,
!is.na(poptot_proj) ~ nb/poptot_proj,
is.na(poptot) & is.na(poptot_proj) ~ NA
) )  %>%
select(-poptot_proj) %>%
rename(sex=sexe,year=annee) %>%
mutate(sex = sex %>% recode("ensemble"="all","femmes"="female","hommes"="male"))
View(FRDreesEHPA)
FRDreesEHPA <- bind_rows(
eff,
eff %>%
select(-sexe) %>%
group_by(annee,age) %>% summarise_all(sum, na.rm=TRUE) %>% ungroup() %>%
mutate(sexe="ensemble")
) %>%
mutate(prevalence=case_when(
!is.na(poptot) ~ nb/poptot,
!is.na(poptot_proj) ~ nb/poptot_proj,
is.na(poptot) & is.na(poptot_proj) ~ NA
) )
View(FRDreesEHPA)
FRDreesEHPA <- bind_rows(
eff,
eff %>%
select(-sexe) %>%
group_by(annee,age) %>% summarise_all(sum, na.rm=TRUE) %>% ungroup() %>%
mutate(sexe="ensemble")
) %>%
mutate(prevalence=case_when(
!is.na(poptot) & poptot>0 ~ nb/poptot,
!is.na(poptot_proj) & poptot_proj>0 ~ nb/poptot_proj,
TRUE ~ NA
) )  %>%
select(-poptot_proj) %>%
rename(sex=sexe,year=annee) %>%
mutate(sex = sex %>% recode("ensemble"="all","femmes"="female","hommes"="male"))
View(FRDreesEHPA)
FRDreesEHPA <- bind_rows(
eff,
eff %>%
select(-sexe) %>%
group_by(annee,age) %>% summarise_all(sum, na.rm=TRUE) %>% ungroup() %>%
mutate(sexe="ensemble")
) %>%
mutate(prevalence=case_when(
!is.na(poptot) & poptot>0 ~ nb/poptot,
!is.na(poptot_proj) & poptot_proj>0 ~ nb/poptot_proj,
TRUE ~ NA
) ,
poptot = case_when(!is.na(poptot) & poptot>0 ~ poptot,
!is.na(poptot_proj) & poptot_proj>0 ~poptot_proj,
TRUE ~ poptot))  %>%
select(-poptot_proj) %>%
rename(sex=sexe,year=annee) %>%
mutate(sex = sex %>% recode("ensemble"="all","femmes"="female","hommes"="male"))
View(FRDreesEHPA)
logit <- function(x){log(x/(1-x))}
eff %>% mutate(annee=as.factor(annee)) %>% ggplot(aes(y=prevalence,x=age,colour=annee,group=annee)) + geom_line() + facet_grid(~sexe) + coord_trans(y = "logit")
eff %>% mutate(annee=as.factor(annee)) %>% ggplot(aes(y=prevalence,x=age,colour=annee,group=annee)) + geom_line() + facet_grid(~sexe) + coord_trans(y = "logit")
FRDreesEHPA %>% mutate(annee=as.factor(annee)) %>% ggplot(aes(y=prevalence,x=age,colour=annee,group=annee)) + geom_line() + facet_grid(~sexe) + coord_trans(y = "logit")
FRDreesEHPA %>% mutate(year=as.factor(year)) %>% ggplot(aes(y=prevalence,x=age,colour=year,group=year)) + geom_line() + facet_grid(~sex) + coord_trans(y = "logit")
# ====================================================================================
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesVQSsurvey2021,
FRDreesAPA2017,
FRDreesAPA,
FRDreesEHPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
nrow(FRDreesEHPA)
library(devtools)
library(readxl)
library(httr)
library(openxlsx)
library(tidyverse)
library(janitor)
load_all()
ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894093/00_central.xlsx"
mortalityMale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteH",
rows=c(2:123))
names(mortalityMale)[1] <- "age3112"
mortalityMale <- mortalityMale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
View(mortalityMale)
mortalityFemale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteF",
rows=c(2:123))
names(mortalityFemale)[1] <- "age3112"
mortalityFemale <- mortalityFemale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
library(devtools)
library(readxl)
library(httr)
library(openxlsx)
library(tidyverse)
library(janitor)
load_all()
# ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894083/00_central.xlsx"
ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894093/00_central.xlsx"
mortalityMale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteH",
rows=c(2:123))
names(mortalityMale)[1] <- "age3112"
mortalityMale <- mortalityMale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
mortalityFemale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteF",
rows=c(2:123))
names(mortalityFemale)[1] <- "age3112"
mortalityFemale <- mortalityFemale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex) %>%  mutate(qx = ifelse(age==max(age),2*qx,qx)) %>%  ungroup() %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(def.age = "age at end of year") %>% rename(age=age3112),
FRmortalityForecast2021_2 %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
FRmortalityForecast2021_all <- FRmortalityForecast2021 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,type.obs,def.age,age) %>% group_by(year,sex,type.obs,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,type.obs,def.age,age) %>% summarise_all(mean) %>% ungroup()
FRmortalityForecast2021_all <- FRmortalityForecast2021_all %>%
left_join(FRmortalityForecast2021_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","type.obs","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
FRInseeMortalityForecast2021 <- bind_rows( FRmortalityForecast2021 , FRmortalityForecast2021_all)
FRInseeMortalityForecast2021 %>% filter(year==1962) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRInseeMortalityForecast2021 %>% filter(year==2021) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRInseeMortalityForecast2021 %>% filter(year==2070) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRInseeMortalityForecast2021 %>% filter(year==2120) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesVQSsurvey2021,
FRDreesAPA2017,
FRDreesAPA,
FRDreesEHPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
nrow(FRInseeMortalityForecast2021)
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type.obs="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type.obs="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type.obs="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type.obs="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
FRInseePopulationForecast2021 <- bind_rows(
# ~~~ 2022 extraction
# read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type.obs="observed"),
# read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type.obs="forecasted") ,
# ~~~ 2026 January updated extraction
read_csv2("https://www.insee.fr/fr/outil-interactif/5014911/data/FR/donnees_pyramide_act.csv") %>% mutate(geo="france",type.obs="observed"),
read_csv2("https://www.insee.fr/fr/outil-interactif/5014911/data/FR/donnees_pyramide_proj.csv") %>% mutate(geo="france",type.obs="forecasted")
)  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
View(FRInseePopulationForecast2021)
verif <- FRInseePopulationForecast2021 %>% count(year,type.obs)
View(verif)
View(verif)
urlproj2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894093/00_central.xlsx"
projMale <- openxlsx::read.xlsx(urlproj2021, sheet = "populationH", rows=c(2:108)) # rows=c(2,102:108))
names(projMale)[1] <- "age0101"
projMale <- projMale %>% pivot_longer(-c("age0101"), names_to = "year", values_to = "popx0101")
projFemale <- openxlsx::read.xlsx(urlproj2021,sheet = "populationF", rows=c(2:108)) # rows=c(2,102:108))
names(projFemale)[1] <- "age0101"
projFemale <- projFemale %>% pivot_longer(-c("age0101"), names_to = "year", values_to = "popx0101")
FRInseePopulationForecast2021_2 <- rbind(
projFemale %>% mutate(sex = "female"),
projMale %>% mutate(sex = "male")
) %>%
#filter(year %in% unique(FRInseePopulationForecast2021$year), popx0101>0) %>%
filter( popx0101>0) %>%
mutate(type.obs = case_when(year<= 2021 ~ "observed",year >= 2022 ~ "forecasted") %>% as.factor(),
age0101 = as.numeric(str_extract(age0101,"^[[:digit:]]+")),
sex = as.factor(sex),
year=as.numeric(year),
geo="france")
View(FRInseePopulationForecast2021_2)
verif <- FRInseePopulationForecast2021 %>% filter(age0101>=99) %>% select(year,sex,age0101,popx0101) %>%
left_join(FRInseePopulationForecast2021_2 %>%
select(year,sex,popx0101) %>%
rename(pop2=popx0101) %>%
group_by(year,sex) %>% summarise_all(sum) %>% ungroup(),
by = c("year","sex")) %>%
mutate(ecart=popx0101-pop2, correc=popx0101/pop2)
View(verif)
verif <- FRInseePopulationForecast2021 %>% filter(age0101>=99) %>% select(year,sex,age0101,popx0101) %>%
left_join(FRInseePopulationForecast2021_2 %>%
filter(age0101>=99) %>%
select(year,sex,popx0101) %>%
rename(pop2=popx0101) %>%
group_by(year,sex) %>% summarise_all(sum) %>% ungroup(),
by = c("year","sex")) %>%
mutate(ecart=popx0101-pop2, correc=popx0101/pop2)
View(verif)
FRInseePopulationForecast2021 <- bind_rows(
#  FRInseePopulationForecast2021 %>%
#    filter(age0101<99,!(year==2022 & type.obs=="forecasted")),
FRInseePopulationForecast2021_2
) %>%
arrange(year,sex,age0101)
View(FRInseePopulationForecast2021)
FRInseePopulationForecast2021 <- bind_rows(
FRInseePopulationForecast2021,
FRInseePopulationForecast2021 %>%
select(-sex) %>%
group_by(year,geo,type.obs,age0101) %>% summarise_all(sum) %>% ungroup() %>%
mutate(sex = "all")
)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesVQSsurvey2021,
FRDreesAPA2017,
FRDreesAPA,
FRDreesEHPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
nrow(FRInseePopulationForecast2021)
View(FRInseePopulationForecast2021)
