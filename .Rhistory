if (max(qmortread$year)<max(prevalApprox$annee)) {
cyearproj <- c((max(qmortread$year)+1):max(prevalApprox$annee))
qmortimput <- qmortread %>%
filter(year %in% c((max(qmortread$year)-4):max(qmortread$year))) %>%
mutate(qx=log(qx)) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup() %>%
left_join(qmortread %>%
filter(year %in% c((max(qmortread$year)-5):(max(qmortread$year)-1))) %>%
mutate(lqx=log(qx)) %>% select(-qx,-year) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup(),
by = c("age","sex") )
qmortproj <- data.frame(
age = rep(unique(qmortimput$age),times=NROW(cyearproj)),
year = rep(cyearproj,each=NROW(unique(qmortimput$age))),
stringsAsFactors = FALSE
)
csex <- unique(qmortread$sex)
qmortproj <- data.frame(
age = rep(qmortproj$age,times=NROW(csex)),
year = rep(qmortproj$year,times=NROW(csex)),
sex = rep(csex,each=nrow(qmortproj))
) %>%
left_join(qmortimput %>% rename(yearref=year),
by = c("age","sex") ) %>%
mutate(qx=qx+(year-yearref)*(qx-lqx),
qx=exp(qx)) %>%
select(year,age,qx,sex)
qmort_t68 <- bind_rows( qmortread, qmortproj)
}
preval_apa_pch_actp <- qmort_t68 %>%
filter(annee==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0)
View(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx))
View(preval_apa_pch_actp)
View(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""))
View(preval_apa_pch_actp)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
select(-agebracket) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
select(-agebracket)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type","year","sex"))
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
View(preval_apa_pch_actp)
tab <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
tab <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
categories=c("prestation","lieu","type")
# remove columns with missing values
tab <- tab[,colSums(is.na(tab))==0]
# if 'categories' is provided, a 'categ' variable is first created
categories <- categories[!(categories %in% c("sex","year"))]
categories.true <- categories[categories != ""]
categories
categories.true
("categ" %in% names(tab))
for (k in 1:NROW(categories)) { tab[,categories[k]] <- paste0("#",k,tab[,categories[k]],"#") }
tab <- tab %>% unite(categ,all_of(categories),sep="")
View(tab)
View(tab)
tab$categ[1]
tab <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
# remove columns with missing values
tab <- tab[,colSums(is.na(tab))==0]
# if 'categories' is provided, a 'categ' variable is first created
categories <- categories[!(categories %in% c("sex","year"))]
categories.true <- categories[categories != ""]
View(tab)
for (k in 1:NROW(categories)) { tab[,categories[k]] <- paste0("#",k,tab[,categories[k]],"#") }
View(tab)
tab$lieu[1]
1:NROW(categories)
View(tab)
class(tab)
tab <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
class(tab)
tab <- as.data.frame(tab)
tab <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
tab <- as.data.frame(tab)
class(tab)
load_all()
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
View(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence)
View(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
mutate(pix = pmax(0,pix)) %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
View(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))
write.csv2(preval_apa_pch_actp,"preval_apa_pch_actp.csv",
fileEncoding = "UTF-8",row.names = FALSE) %>%
rename(annee=year,sexe=sex,prevalence=pix)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.","")) %>%
select(-agebracket)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","lieu","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix)
View(preval_apa_pch_actp)
View(prevalApprox)
View(prevalApproxPH)
View(prevalApproxAPA)
View(prevalApprox)
prevalApprox <- bind_rows(
prevalApproxAPA,
prevalApproxPH,
bind_rows(
prevalApproxAPA %>% filter(prestation %in% c("APA"),sexe=="Ensemble"),
prevalApproxPH ) %>%
select(annee,age,starts_with("prevalence")) %>%
group_by(annee,age) %>% summarise_all(sum) %>% ungroup() %>%
mutate(prestation = "APA+PCH+ACTP")
) %>%
mutate(sexe = ifelse(is.na(sexe),"Ensemble",sexe)) %>%
select(-lieu,-agebracket)
View(prevalApprox)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix)
View(preval_apa_pch_actp)
View(preval_apa_pch_actp)
View(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix) %>%
select(annee,age,prestation,sexe,type,qx,prevalence,
DLx,DFLEx,DLEx,meanDAx,medianDAx,modelDAx)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix) %>%
select(annee,age,prestation,sexe,type,qx,prevalence,
DLx,DFLEx,DLEx,MeanDAx,MedianDAx,ModelDAx)
View(preval_apa_pch_actp)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix)
names(preval_apa_pch_actp)
preval_apa_pch_actp <- qmort_t68 %>%
filter(year==2019) %>%
mutate(age0 = pmin(99,age),
sex = recode(sex,"male"="Hommes","female"="Femmes","all"="Ensemble")) %>%
rename(annee = year,sexe=sex) %>%
left_join(prevalApprox %>%  rename(age0=age) %>% mutate(annee=as.numeric(annee)),
by =c("annee","age0","sexe")) %>%
select(-age0) %>%
filter(!is.na(prevalence.approx)) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""))
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix) %>%
select(annee,age,prestation,sexe,type,qx,prevalence,
DLx,DFLEx,DLEx,MeanDAx,MedianDAx,ModelDAx)
preval_apa_pch_actp <- preval_apa_pch_actp %>%
rename(year=annee,sex=sexe,pix=prevalence) %>%
mutate(pix = pmax(0,pix)) %>%
CompleteDFLEtable(categories=c("prestation","type"))  %>%
rename(annee=year,sexe=sex,prevalence=pix) %>%
select(annee,age,prestation,sexe,type,qx,prevalence,
DLx,DFLEx,DLEx,MeanDAx,MedianDAx,ModalDAx)
View(preval_apa_pch_actp)
write.csv2(preval_apa_pch_actp,"preval_apa_pch_actp.csv",
fileEncoding = "UTF-8",row.names = FALSE)
preval_apa_pch_actp <- read.csv2("preval_apa_pch_actp.csv",fileEncoding = "UTF-8")
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",age<=70,age>=45,prestation %in% c("APA","PCH","ACTP")) %>%
select(prestation,age,type,prevalence)  %>%
ggplot(aes(x=age,y=prevalence,colour=prestation,linetype=type)) +
geom_line()
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),age<=75,age>=20) %>%
select(prestation,age,prevalence.approx,prevalence.raw) %>%
pivot_longer(cols=starts_with("prevalence"),names_to="type",values_to="prevalence") %>%
mutate(type = str_replace(type,"^prevalence\\.",""),
prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=prevalence,fill=prestation) ) +
geom_area() +
facet_wrap(~type)
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),age<=75,age>=20) %>%
select(prestation,age,type,prevalence) %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=prevalence,fill=prestation) ) +
geom_area() +
facet_wrap(~type)
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",age<=70,age>=45,prestation %in% c("APA","PCH","ACTP")) %>%
select(prestation,age,type,DLx)  %>%
ggplot(aes(x=age,y=DLx,colour=prestation,linetype=type)) +
geom_line()
View(preval_apa_pch_actp)
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP")) %>%
select(prestation,age,type,DLx)  %>%
ggplot(aes(x=age,y=DLx,colour=prestation,linetype=type)) +
geom_line()
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),type=="approx") %>%
select(prestation,age,type,DLx)  %>%
ggplot(aes(x=age,y=DLx,colour=prestation,linetype=type)) +
geom_area()
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),type=="approx") %>%
select(prestation,age,type,DLx)  %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=DLx,fill=prestation)) +
geom_area()
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),age<=75,age>=20) %>%
select(prestation,age,type,prevalence) %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=prevalence,fill=prestation) ) +
geom_area() +
facet_wrap(~type)
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),age>=20) %>%
select(prestation,age,type,prevalence) %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=prevalence,fill=prestation) ) +
geom_area() +
facet_wrap(~type)
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),age<=75,age>=20) %>%
select(prestation,age,type,prevalence) %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=prevalence,fill=prestation) ) +
geom_area() +
facet_wrap(~type)
preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),type=="approx") %>%
select(prestation,age,type,DLx)  %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=DLx,fill=prestation)) +
geom_area()
tabLx <- preval_apa_pch_actp %>%
filter(sexe=="Ensemble",prestation %in% c("APA","PCH","ACTP"),type=="approx") %>%
select(prestation,age,type,DLx)  %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP")))
tabLx %>%
ggplot(aes(x=age,y=DLx,fill=prestation)) +
geom_area()
tabLx %>%
left_join(tabLx %>% mutate(age=age+1) %>% rename(lDLx=Dlx),
by=c("prestation","age","type")) %>%
mutate(delta_DLx=DLx-lDLx) %>%
ggplot(aes(x=age,y=delta_DLx,fill=prestation)) +
geom_area()
tabLx %>%
left_join(tabLx %>% mutate(age=age+1) %>% rename(lDLx=DLx),
by=c("prestation","age","type")) %>%
mutate(delta_DLx=DLx-lDLx) %>%
ggplot(aes(x=age,y=delta_DLx,fill=prestation)) +
geom_area()
tabLx <- preval_apa_pch_actp %>%
filter(sexe=="Ensemble",type=="approx") %>%
select(prestation,age,type,DLx)  %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP")))
tabLx %>%
filter(prestation %in% c("APA","PCH","ACTP")) %>%
ggplot(aes(x=age,y=DLx,fill=prestation)) +
geom_area()
tabLx %>%
left_join(tabLx %>% mutate(age=age+1) %>% rename(lDLx=DLx),
by=c("prestation","age","type")) %>%
mutate(delta_DLx=DLx-lDLx) %>%
filter(prestation %in% c("APA","APA+PCH+ACTP")) %>%
ggplot(aes(x=age,y=delta_DLx,fill=prestation)) +
geom_line()
tabLx %>%
left_join(tabLx %>% mutate(age=age+1) %>% rename(lDLx=DLx),
by=c("prestation","age","type")) %>%
mutate(delta_DLx=DLx-lDLx) %>%
filter(prestation %in% c("APA","APA+PCH+ACTP")) %>%
ggplot(aes(x=age,y=delta_DLx,colour=prestation,group=prestation)) +
geom_line()
unique(tabLx$prestation)
tabLx <- preval_apa_pch_actp %>%
filter(sexe=="Ensemble",type=="approx") %>%
select(prestation,age,type,DLx)
tabLx %>%
filter(prestation %in% c("APA","PCH","ACTP"))  %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=DLx,fill=prestation)) +
geom_area()
tabLx %>%
left_join(tabLx %>% mutate(age=age+1) %>% rename(lDLx=DLx),
by=c("prestation","age","type")) %>%
mutate(delta_DLx=DLx-lDLx) %>%
filter(prestation %in% c("APA","APA+PCH+ACTP")) %>%
ggplot(aes(x=age,y=delta_DLx,colour=prestation,group=prestation)) +
geom_line()
tabLx %>%
filter(prestation %in% c("APA","PCH","ACTP"))  %>%
mutate(prestation = factor(prestation, levels=c("APA","PCH","ACTP"))) %>%
ggplot(aes(x=age,y=DLx,fill=prestation)) +
geom_area()
tabLx %>%
left_join(tabLx %>% mutate(age=age+1) %>% rename(lDLx=DLx),
by=c("prestation","age","type")) %>%
mutate(delta_DLx=DLx-lDLx) %>%
filter(prestation %in% c("APA","APA+PCH+ACTP")) %>%
ggplot(aes(x=age,y=delta_DLx,colour=prestation,group=prestation)) +
geom_line()
