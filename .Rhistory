prevalapaproj <- prevalenceForecast(
tabref = popapaproj %>% filter(year==2019) %>%
left_join(prevalapa %>% filter(annee==2019,prestation=="APA") %>%
select(-prestation) %>%
rename(pix=preval,year=annee),
by =c("year","age")) %>%
group_by(year) %>% mutate(pix = ifelse(is.na(pix),max(pix,na.rm=TRUE),pix)) %>% ungroup(),
tabproj = popapaproj %>% filter(year>2019),
hypo="cstDLE") %>%
select(year,age,pix) %>%
rename(annee=year,preval=pix) %>%
mutate(preval = pmax(0,pmin(1,preval)) )
decapa_dlecste <- decoupage(pop=popref %>% filter(age>=60),
preval=prevalapaproj,prevaldef=NULL)
prevalapaetabproj <- prevalenceForecast(
tabref = popapaproj %>% filter(year==2019) %>%
left_join(prevalapa %>% filter(annee==2019,prestation=="APAetab") %>%
select(-prestation) %>%
rename(pix=preval,year=annee),
by =c("year","age")) %>%
group_by(year) %>% mutate(pix = ifelse(is.na(pix),max(pix,na.rm=TRUE),pix)) %>% ungroup(),
tabproj = popapaproj %>% filter(year>2019),
hypo="cstDLE") %>%
select(year,age,pix) %>%
rename(annee=year,preval=pix) %>%
mutate(preval = pmax(0,pmin(1,preval)) )
decapaetab_dlecste <- decoupage(pop=popref %>% filter(age>=60),
preval=prevalapaetabproj,prevaldef=NULL)
# == une table de synthèse avec la part des gén du babyboom
partbabyboom <- bind_rows(
decretraites %>% mutate(indic="retr"),
decapa_prevalcstes %>% mutate(indic="apaprevalcst"),
decapaetab_prevalcstes %>% mutate(indic="apaetabprevalcst"),
decapa_dlecste %>% mutate(indic="apadlecst"),
decapaetab_dlecste %>% mutate(indic="apaetabdlecst")
) %>%
filter(gen=="Baby boomers") %>%
select(annee,indic,part,nb)
# min((partbabyboom %>% filter(indic=="retr",part>=50))$annee)
# (partbabyboom %>% filter(indic=="retr") %>% filter(part==max(part)))$annee
# (partbabyboom %>% filter(indic=="retr",annee==2022) )$part
# max((partbabyboom %>% filter(indic=="apaprevalcst",part>=50))$annee)
# max((partbabyboom %>% filter(indic=="apadlecst",part>=50))$annee)
# (partbabyboom %>% filter(indic=="apadlecst") %>% filter(part==max(part)))$annee
# (partbabyboom %>% filter(indic=="apadlecst") %>% filter(nb==max(nb)))$annee
# (partbabyboom %>% filter(indic=="apaprevalcst") %>% filter(nb==max(nb)))$nb
View(popref)
truc <- popref %>% filter(age==60)
View(truc)
popapaproj <- healthexpectancies::FRInseeMortalityForecast2021 %>%
filter(year>=2019,sex=="all",age>=60,def.age=="current age (approx)") %>%
select(age,year,qx)
prevalapaproj <- prevalenceForecast(
tabref = popapaproj %>% filter(year==2019) %>%
left_join(prevalapa %>% filter(annee==2019,prestation=="APA") %>%
select(-prestation) %>%
rename(pix=preval,year=annee),
by =c("year","age")) %>%
group_by(year) %>% mutate(pix = ifelse(is.na(pix),max(pix,na.rm=TRUE),pix)) %>% ungroup(),
tabproj = popapaproj %>% filter(year>2019),
hypo="cstDLE")
verifapaproj <- prevalapaproj %>% filter(age==60) %>% select(year,ex,DLEx,pctDLEx)
popapaproj <- healthexpectancies::FRInseeMortalityForecast2021 %>%
filter(year>=2019,sex=="all",age>=60,def.age=="current age (approx)") %>%
select(age,year,qx)
prevalapaproj <- prevalenceForecast(
tabref = popapaproj %>% filter(year==2019) %>%
left_join(prevalapa %>% filter(annee==2019,prestation=="APA") %>%
select(-prestation) %>%
rename(pix=preval,year=annee),
by =c("year","age")) %>%
group_by(year) %>% mutate(pix = ifelse(is.na(pix),max(pix,na.rm=TRUE),pix)) %>% ungroup(),
tabproj = popapaproj %>% filter(year>2019),
hypo="cstDLE")
names(prevalapaproj)
verifapaproj <- prevalapaproj %>% filter(age==60)
View(verifapaproj)
View(decapa_prevalcstes)
verif <- decapa_prevalcstes %>% select(-gen) %>% group_by(annee) %>% summarise_all(sum) %>% ungroup()
View(verif)
verif <- decapa_dlecste %>% select(-gen) %>% group_by(annee) %>% summarise_all(sum) %>% ungroup()
View(verifapaproj)
View(verif)
View(verifapaproj)
verif <- decapa_prevalcstes %>% select(-gen) %>% group_by(annee) %>% summarise_all(sum) %>% ungroup()
View(verif)
View(prevalapa)
library(devtools)
library(readxl)
library(openxlsx)
library(tidyverse)
load_all()
url_t69 <- "https://www.insee.fr/fr/statistiques/fichier/6036439/fe_dod_quotients_mortalite.xlsx"
url_t69 <- "https://www.insee.fr/fr/statistiques/fichier/6036439/fe_dod_quotients_mortalite.xlsx"
qmort_t69 <- bind_rows(
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-F", #"qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-H", #"qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
View(qmort_t69)
qmort_t69_bis <- bind_rows(
qmort_t69 %>% mutate(qx=qx/2,age=pmax(0,age-1)),
qmort_t69 %>% mutate(qx=qx/2)
) %>%
group_by(year,sex,age) %>% summarise_all(sum) %>% ungroup()
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(def.age = "age at end of year"),
qmort_t69_bis %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
View(qmort_t69)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,def.age,age) %>% summarise_all(mean) %>% ungroup()
View(qmort_t69_all)
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
View(qmort_t69_all)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
document()
library(devtools)
library(readxl)
library(openxlsx)
library(tidyverse)
load_all()
url_t69 <- "https://www.insee.fr/fr/statistiques/fichier/6036439/fe_dod_quotients_mortalite.xlsx"
qmort_t69 <- bind_rows(
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-F", #"qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-H", #"qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
View(corr_ref)
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",year==max(FRInseeMortalityrates$year))
View(corr_ref)
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
View(qmort_t69)
corr <- qmort_t69 %>%
filter(year>=max(FRInseeMortalityrates$year)-1,year<=max(FRInseeMortalityrates$year)+1) %>%
select(-year)
View(corr)
corr <- qmort_t69 %>%
filter(year>=max(FRInseeMortalityrates$year)-1,year<=max(FRInseeMortalityrates$year)+1) %>%
select(-year) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup()
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
corr <- qmort_t69 %>%
filter(year>=max(FRInseeMortalityrates$year)-1,year<=max(FRInseeMortalityrates$year)+1) %>%
select(-year) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup()
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
corr <- corr_ref %>%
left_join(corr %>% rename(qx_69=qx), by=c("sex","age")) %>%
left_join(corr %>% rename(qx_69p=qx) %>% mutate(age=age-1), by=c("sex","age")) %>%
arrange(sex,age) %>%
group_by(sex) %>%
mutate(ecart=cumsum(qx)-cumsum(qx_69)) %>%
ungroup() %>%
mutate(px=ecart/qx_69p)
View(corr)
corr <- qmort_t69 %>%
filter(year>=max(FRInseeMortalityrates$year)-1,year<=max(FRInseeMortalityrates$year)+1) %>%
select(-year) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup()
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",sex!="all",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
corr <- corr_ref %>%
left_join(corr %>% rename(qx_69=qx), by=c("sex","age")) %>%
left_join(corr %>% rename(qx_69p=qx) %>% mutate(age=age-1), by=c("sex","age")) %>%
arrange(sex,age) %>%
group_by(sex) %>%
mutate(ecart=cumsum(qx)-cumsum(qx_69)) %>%
ungroup() %>%
mutate(px=ecart/qx_69p)
View(corr)
corr <- qmort_t69 %>%
filter(year>=max(FRInseeMortalityrates$year)-1,year<=max(FRInseeMortalityrates$year)+1) %>%
select(-year) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup()
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",sex!="all",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
corr <- corr_ref %>%
left_join(corr %>% rename(qx_69=qx), by=c("sex","age")) %>%
left_join(corr %>% rename(qx_69p=qx) %>% mutate(age=age-1), by=c("sex","age")) %>%
arrange(sex,age) %>%
group_by(sex) %>%
mutate(ecart=cumsum(qx)-cumsum(qx_69)) %>%
ungroup() %>%
mutate(px=ecart/qx_69p,
age=age+1) %>%
filter(!is.na(px)) %>%
select(sex,age,px)
View(corr)
qmort_t69_bis <- qmort_t69 %>% left_join(corr,by=c("sex","age"))
View(qmort_t69_bis)
View(corr)
qmort_t69_bis <- qmort_t69 %>%
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% mutate(age=age-1),by=c("sex","age"))
View(qmort_t69_bis)
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age"))
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr%>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age"))
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age"))
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age"))
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age")) %>%
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age"))
View(qmort_t69_bis)
View(qmort_t69_bis)
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age")) %>%
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age")) %>%
mutate(px = case_when(
!is.na(px) ~ px,
is.na(px) & age==0 ~ 0,
is.na(px) & age>0 ~0.5
),
qxf = ifelse(is.na(qxf),qx,qxf),
pxf = ifelse(is.na(pxf),px,pxf))
View(qmort_t69_bis)
View(corr)
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age")) %>%
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age")) %>%
mutate(px = case_when(
!is.na(px) ~ px,
is.na(px) & age==0 ~ 0,
is.na(px) & age>0 ~0.5
),
qxf = ifelse(is.na(qxf),qx,qxf),
pxf = ifelse(is.na(pxf),px,pxf)) %>%
mutate(qx = (1-px)*qx + pxf*qxf)
View(qmort_t69_bis)
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age")) %>%
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age")) %>%
mutate(px = case_when(
!is.na(px) ~ px,
is.na(px) & age==0 ~ 0,
is.na(px) & age>0 ~0.5
),
qxf = ifelse(is.na(qxf),qx,qxf),
pxf = ifelse(is.na(pxf),px,pxf)) %>%
mutate(qx = (1-px)*qx + pxf*qxf) %>%
select(year,age,sex,qx)
View(qmort_t69_bis)
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(def.age = "age at end of year"),
qmort_t69_bis %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,def.age,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
library(devtools)
library(readxl)
library(openxlsx)
library(tidyverse)
load_all()
truc <- FRInseeMortalityrates_t69
View(truc)
library(devtools)
load_all()
library(devtools)
library(readxl)
library(openxlsx)
library(tidyverse)
load_all()
url_t69 <- "https://www.insee.fr/fr/statistiques/fichier/6036439/fe_dod_quotients_mortalite.xlsx"
qmort_t69 <- bind_rows(
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-F", #"qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-H", #"qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
corr <- qmort_t69 %>%
filter(year>=max(FRInseeMortalityrates$year)-1,year<=max(FRInseeMortalityrates$year)+1) %>%
select(-year) %>%
group_by(sex,age) %>% summarise_all(mean) %>% ungroup()
corr_ref <- FRInseeMortalityrates %>%
filter(geo=="france",sex!="all",year==max(FRInseeMortalityrates$year)) %>%
select(sex,age,qx)
corr <- corr_ref %>%
left_join(corr %>% rename(qx_69=qx), by=c("sex","age")) %>%
left_join(corr %>% rename(qx_69p=qx) %>% mutate(age=age-1), by=c("sex","age")) %>%
arrange(sex,age) %>%
group_by(sex) %>%
mutate(ecart=cumsum(qx)-cumsum(qx_69)) %>%
ungroup() %>%
mutate(px=ecart/qx_69p,
age=age+1) %>%
filter(!is.na(px)) %>%
select(sex,age,px)
View(corr)
qmort_t69_bis <- qmort_t69 %>%
left_join(corr ,by=c("sex","age")) %>%
left_join(qmort_t69 %>% rename(qxf=qx) %>% mutate(age=age-1) %>% filter(age>=0), by=c("year","sex","age")) %>%
left_join(corr %>% rename(pxf=px)  %>% mutate(age=age-1),by=c("sex","age")) %>%
mutate(px = case_when(
!is.na(px) ~ px,
is.na(px) & age==0 ~ 0,
is.na(px) & age>0 ~0.5
),
qxf = ifelse(is.na(qxf),qx,qxf),
pxf = ifelse(is.na(pxf),px,pxf)) %>%
mutate(qx = (1-px)*qx + pxf*qxf) %>%
select(year,age,sex,qx)
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(def.age = "age at end of year"),
qmort_t69_bis %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
view(FRInseePopulation)
View(qmort_t69)
partnaiss <- FRInseePopulation %>% filter(age0101==0)
View(partnaiss)
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx) %>%
mutate(sex = recode(sex, "M"="male","F"="female")) %>%
rename(popx=partnaiss) %>%
group_by(year) %>% mutate(partnaiss=partnaiss/sum(partnaiss)) %>% ungroup()
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx) %>%
mutate(sex = recode(sex, "M"="male","F"="female")) %>%
rename(popx=partnaiss)
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx)
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx) %>%
mutate(sex = recode(as.character(as.numeric(sex)), "M"="male","F"="female")) %>%
rename(popx=partnaiss) %>%
group_by(year) %>% mutate(partnaiss=partnaiss/sum(partnaiss)) %>% ungroup()
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx)
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx) %>%
mutate(sex = recode(as.character(as.numeric(sex)), "M"="male","F"="female")) %>%
rename(partnaiss=popx) %>%
group_by(year) %>% mutate(partnaiss=partnaiss/sum(partnaiss)) %>% ungroup()
View(partnaiss)
partnaiss <- FRInseePopulation %>% filter(age0101==0) %>% select(year,sex,popx) %>%
mutate(sex = recode(as.character(sex), "M"="male","F"="female")) %>%
rename(partnaiss=popx)
View(partnaiss)
partnaiss <- FRInseePopulation %>% filter(age0101==0)
View(partnaiss)
partnaiss <- FRInseePopulation %>% filter(age0101==0,geo=="france") %>% select(year,sex,popx) %>%
mutate(sex = recode(as.character(sex), "M"="male","F"="female")) %>%
rename(partnaiss=popx) %>%
group_by(year) %>% mutate(partnaiss=partnaiss/sum(partnaiss)) %>% ungroup()
View(partnaiss)
partnaiss <- FRInseePopulation %>% filter(age0101==0,geo=="france") %>% select(year,sex,popx) %>%
mutate(sex = recode(as.character(sex), "M"="male","F"="female"),
year=year-1) %>%
rename(partnaiss=popx) %>%
group_by(year) %>% mutate(partnaiss=partnaiss/sum(partnaiss)) %>% ungroup()
View(partnaiss)
View(qmort_t69)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup()
View(qmort_t69_all)
View(partnaiss)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
left_join(partnaiss, by=c("year","sex") ) %>%
mutate(qx = qx * partnaiss)
View(qmort_t69_all)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
left_join(partnaiss, by=c("year","sex") ) %>%
mutate(qx = qx * partnaiss) %>%
select(-sex,-partnaiss) %>% group_by(year,def.age,age) %>% summarise_all(sum) %>% ungroup()
View(qmort_t69_all)
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
View(qmort_t69_all)
View(qmort_t69_all)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
library(devtools)
load_all()
install()
