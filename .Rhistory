left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,def.age,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
View(FRInseeMortalityrates_t69)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseePopulationForecast2016,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
document()
view(FRGaliEUSilc)
document()
library(devtools)
library(readxl)
library(openxlsx)
library(tidyverse)
load_all()
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex),
geo = as.factor(geo))
View(FRInseePopulationForecast2021)
View(FRInseePopulationForecast2021)
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex),
geo = as.factor(geo),
sex = recode(sex, "M" = "male", "F" = "female"))
View(FRInseePopulationForecast2021)
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
FRInseePopulationForecast2021 <- bind_rows(
FRInseePopulationForecast2021,
FRInseePopulationForecast2021 %>%
select(-sex) %>%
group_by(year,geo) %>% summarise(sum) %>% ungroup() %>%
mutate(sex = "all")
)
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
FRInseePopulationForecast2021 <- bind_rows(
FRInseePopulationForecast2021,
FRInseePopulationForecast2021 %>%
select(-sex) %>%
group_by(year,geo,age0101) %>% summarise(sum) %>% ungroup() %>%
mutate(sex = "all")
)
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
FRInseePopulationForecast2021 <- bind_rows(
FRInseePopulationForecast2021,
FRInseePopulationForecast2021 %>%
select(-sex) %>%
group_by(year,geo,type,age0101) %>% summarise(sum) %>% ungroup() %>%
mutate(sex = "all")
)
FRInseePopulationForecast2021 <- bind_rows(
read_csv2("data-raw/donnees_pyramide_act_2022.csv") %>% mutate(geo="france",type="observed"),
read_csv2("data-raw/donnees_pyramide_proj_2022.csv") %>% mutate(geo="france",type="forecasted")  )  %>%
rename(year = ANNEE,
sex = SEXE,
popx0101 = POP,
age0101 = AGE) %>%
mutate(year = as.numeric(year),
age0101 = as.numeric(age0101),
sex = as.factor(sex) %>% recode("M" = "male", "F" = "female"),
geo = as.factor(geo) )
View(FRInseePopulationForecast2021)
FRInseePopulationForecast2021 <- bind_rows(
FRInseePopulationForecast2021,
FRInseePopulationForecast2021 %>%
select(-sex) %>%
group_by(year,geo,type,age0101) %>% summarise(sum) %>% ungroup() %>%
mutate(sex = "all")
)
truc <- FRInseePopulationForecast2021 %>%
select(-sex)
FRInseePopulationForecast2021 <- bind_rows(
FRInseePopulationForecast2021,
FRInseePopulationForecast2021 %>%
select(-sex) %>%
group_by(year,geo,type,age0101) %>% summarise_all(sum) %>% ungroup() %>%
mutate(sex = "all")
)
View(FRInseePopulationForecast2021)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
load_all()
build()
document()
build_site()
library(devtools)
library(readxl)
library(openxlsx)
library(tidyverse)
load_all()
ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894083/00_central.xlsx"
ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894083/00_central.xlsx"
mortalityMale <- read_excel(ulrmort2021,
sheet = "hyp_mortaliteH",
range = "A2:DF123")
names(mortalityMale)[1] <- "age3112"
?read.xlsx
ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894083/00_central.xlsx"
mortalityMale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteH",
rows=c(2:123))
names(mortalityMale)[1] <- "age3112"
View(mortalityMale)
mortalityMale <- mortalityMale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/10000 )
View(mortalityMale)
View(mortalityMale)
mortalityMale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteH",
rows=c(2:123))
names(mortalityMale)[1] <- "age3112"
mortalityMale <- mortalityMale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
mortalityFemale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteF",
rows=c(2:123))
names(mortalityFemale)[1] <- "age3112"
mortalityFemale <- mortalityFemale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(year),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
unique(mortalityFemale$year)
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted"),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
View(FRmortalityForecast2021)
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
# transform dataset from age at the end of the year to age at last birthday
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
View(FRmortalityForecast2021_2)
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(type.age = "age at the end of the year"),
FRmortalityForecast2021_2 %>% mutate(type.age = "age at last birthday")
) %>%
mutate(type.age = as.factor(type.age))
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
# transform dataset from age at the end of the year to age at last birthday
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(def.age = "age at the end of the year"),
FRmortalityForecast2021_2 %>% mutate(def.age = "age at last birthday")
) %>%
mutate(def.age = as.factor(def.age))
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
# transform dataset from age at the end of the year to age at last birthday
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(def.age = "age at the end of the year") %>% rename(age=age3112),
FRmortalityForecast2021_2 %>% mutate(def.age = "age at last birthday")
) %>%
mutate(def.age = as.factor(def.age))
FRmortalityForecast2021_all <- FRmortalityForecast2021 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,type.obs,def.age,age) %>% group_by(year,sex,type.obs,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,type.obs,def.age,age) %>% summarise_all(mean) %>% ungroup()
View(FRmortalityForecast2021_all)
FRmortalityForecast2021_all <- FRmortalityForecast2021_all %>%
left_join(FRmortalityForecast2021_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","type.obs","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
View(FRmortalityForecast2021_all)
FRmortalityForecast2021 <- bind_rows( FRmortalityForecast2021 , FRmortalityForecast2021_all)
View(FRmortalityForecast2021)
usethis::use_data(FRInseeMortalityForecast2016,
FRmortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
FRmortalityForecast2021 %>% filter(year==2020) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==2070) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==1962) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==1963) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==1962) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==2021) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
# transform dataset from age at the end of the year to age at last birthday
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex) %>%  mutate(qx = ifelse(age==max(age),2*qx,qx)) %>%  ungroup() %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(def.age = "age at the end of the year") %>% rename(age=age3112),
FRmortalityForecast2021_2 %>% mutate(def.age = "age at last birthday")
) %>%
mutate(def.age = as.factor(def.age))
# adding mortality rates for both sex, supposing there are 50-50 men and women ar birth
FRmortalityForecast2021_all <- FRmortalityForecast2021 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,type.obs,def.age,age) %>% group_by(year,sex,type.obs,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,type.obs,def.age,age) %>% summarise_all(mean) %>% ungroup()
FRmortalityForecast2021_all <- FRmortalityForecast2021_all %>%
left_join(FRmortalityForecast2021_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","type.obs","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
FRmortalityForecast2021 <- bind_rows( FRmortalityForecast2021 , FRmortalityForecast2021_all)
FRmortalityForecast2021 %>% filter(year==2021) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==1962) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
FRmortalityForecast2021 %>% filter(year==2070) %>% ggplot(aes(y=qx,x=age,colour=sex,group=sex)) + geom_line() + facet_wrap(~def.age)
usethis::use_data(FRInseeMortalityForecast2016,
FRmortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
ulrmort2021 <- "https://www.insee.fr/fr/statistiques/fichier/5894083/00_central.xlsx"
mortalityMale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteH",
rows=c(2:123))
names(mortalityMale)[1] <- "age3112"
mortalityMale <- mortalityMale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
mortalityFemale <- openxlsx::read.xlsx(ulrmort2021,
sheet = "hyp_mortaliteF",
rows=c(2:123))
names(mortalityFemale)[1] <- "age3112"
mortalityFemale <- mortalityFemale %>%
pivot_longer(-c("age3112"), names_to = "year", values_to = "qx") %>%
mutate(qx = qx/100000 )
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex) %>%  mutate(qx = ifelse(age==max(age),2*qx,qx)) %>%  ungroup() %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(def.age = "age at end of year") %>% rename(age=age3112),
FRmortalityForecast2021_2 %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
FRmortalityForecast2021_all <- FRmortalityForecast2021 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,type.obs,def.age,age) %>% group_by(year,sex,type.obs,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,type.obs,def.age,age) %>% summarise_all(mean) %>% ungroup()
FRmortalityForecast2021_all <- FRmortalityForecast2021_all %>%
left_join(FRmortalityForecast2021_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","type.obs","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
FRmortalityForecast2021 <- bind_rows( FRmortalityForecast2021 , FRmortalityForecast2021_all)
usethis::use_data(FRInseeMortalityForecast2016,
FRmortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
document()
FRmortalityForecast2021 <- rbind(
mortalityFemale %>% mutate(sex = "female"),
mortalityMale %>% mutate(sex = "male")
) %>%
mutate(year = as.numeric(str_extract(year,"^[[:digit:]]{4}")),
type.obs = case_when(year<= 2017 ~ "observed",
year>2017 & year <= 2020 ~ "observed (prov.)",
year >= 2021 ~ "forecasted") %>% as.factor(),
age3112 = as.numeric(age3112),
sex = as.factor(sex))
# transform dataset from age at the end of the year to age at last birthday
FRmortalityForecast2021_2 <- rbind(
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = age3112),
FRmortalityForecast2021 %>% mutate(qx = qx/2, age = pmax(0,age3112-1) )
) %>%
select(-age3112) %>%
group_by(year,type.obs,sex) %>%  mutate(qx = ifelse(age==max(age),2*qx,qx)) %>%  ungroup() %>%
group_by(year,type.obs,sex,age) %>%
summarise_all(sum) %>%
ungroup()
FRmortalityForecast2021 <- bind_rows(
FRmortalityForecast2021  %>% mutate(def.age = "age at end of year") %>% rename(age=age3112),
FRmortalityForecast2021_2 %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
# adding mortality rates for both sex, supposing there are 50-50 men and women ar birth
FRmortalityForecast2021_all <- FRmortalityForecast2021 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,type.obs,def.age,age) %>% group_by(year,sex,type.obs,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,type.obs,def.age,age) %>% summarise_all(mean) %>% ungroup()
FRmortalityForecast2021_all <- FRmortalityForecast2021_all %>%
left_join(FRmortalityForecast2021_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","type.obs","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
FRInseeMortalityForecast2021 <- bind_rows( FRmortalityForecast2021 , FRmortalityForecast2021_all)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
document()
