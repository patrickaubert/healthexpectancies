vyear <- unique( c(refyear, 2030, 2020, 2025, 2030, 2035, 2040, 2050) )
vyear <- vyear[order(vyear)]
donneespop <- FRInseePopulationForecast2016 %>%
rename(age = age0101) %>%
mutate(year = as.numeric(year),
age = as.numeric( age ),
sex = as.factor(sex)) %>%
mutate(year = year-1) %>%
filter(age >= 60, year %in% c( vyear ) )
donneesprev <- rbind(
FRDreesVQSsurvey2014,
FRDreesAPA2017 %>% rename(limitationtype = typepresta)
) %>%
filter(limitationtype == input$limtype ) %>%
select(-age)
donneesprev <- rbind(
FRDreesVQSsurvey2014,
FRDreesAPA2017 %>% rename(limitationtype = typepresta)
) %>%
filter(limitationtype == "GALI" ) %>%
select(-age)
donneesregr <- donneespop %>%
mutate(agebracket = cut(age, breaks = c(seq(60,95,5),Inf), include.lowest = TRUE, right = FALSE)) %>%
filter(year == refyear, age>=60) %>%
left_join( donneesprev,   by = c("sex","agebracket") ) %>%
rename(prevalence.ref = prevalence)
prevalencesref <- donneesregr %>% group_by(sex) %>%
mutate(prev.approx = case_when(
#input$approxPrev ~ prevalence_to_polynomial(age, prevalence.ref, weight=popx),
TRUE ~ prevalence_to_polynomial(prevalence = prevalence.ref,
agemin=min(donneesregr$age),
agemax=max(donneesregr$age),
weight=popx),
!input$approxPrev ~ prevalence.ref) ) %>%
ungroup() %>%
select(sex, age, prev.approx, prevalence.ref) %>%
pivot_longer(cols=-c(sex,age),
names_to = "indicateur",
values_to = "prevalence")
prevalencesref <- donneesregr %>% group_by(sex) %>%
mutate(prev.approx = case_when(
#input$approxPrev ~ prevalence_to_polynomial(age, prevalence.ref, weight=popx),
TRUE ~ prevalence_to_polynomial(prevalence = prevalence.ref,
agemin=min(donneesregr$age),
agemax=max(donneesregr$age),
weight=popx),
FALSE ~ prevalence.ref) ) %>%
ungroup() %>%
select(sex, age, prev.approx, prevalence.ref) %>%
pivot_longer(cols=-c(sex,age),
names_to = "indicateur",
values_to = "prevalence")
prevref <- prevalencesref %>%
filter(indicateur == "prev.approx") %>%
rename(pix = prevalence) %>%
select(sex,age,pix)
qmortref <- FRInseeMortalityForecast2016 %>%
# on filtre selon l'âge et l'année
select(year,sex,age,qx) %>%
filter(age >= 60, age <= 110, year %in% c(refyear) ) %>%
# on ajoute les prévalences en projection
left_join(prevref, by = c("sex","age")) %>%
filter(!is.na(pix), !is.na(qx))
qmortproj <- FRInseeMortalityForecast2016 %>%
select(year,sex,age,qx) %>%
filter(age >= 60, age <= input$ageFinCalcul, year %in% c( vyear[vyear != refyear] )
)
qmortproj <- FRInseeMortalityForecast2016 %>%
select(year,sex,age,qx) %>%
filter(age >= 60, age <= 110, year %in% c( vyear[vyear != refyear] ) )
projections <- prevalenceForecast( qmortref, qmortproj , input$optionProj,
includevars  = c("MeanDAx","MedianDAx","ModalDAx")) %>%
select(sex,age,year,ex,DFLEx,DLEx,pctDFLEx,pix,MeanDAx,MedianDAx,ModalDAx)
projections <- prevalenceForecast( qmortref, qmortproj , "CstDFLE",
includevars  = c("MeanDAx","MedianDAx","ModalDAx"))
tabref<-qmortref
tabproj<-qmortproj
hypo<-"CstDFLE"
includevars  = c("MeanDAx","MedianDAx","ModalDAx")
vardim <- intersect( c("sex","age","categ") , intersect(names(tabref), names(tabproj)) )
varkeep <- recode(hypo,
"cstDFLE" = "DFLEx",
"cstDLE" = "DLEx",
"cstPctDFLE" = "pctDFLEx",
"cstPrev" = "pix")
vardim
varkeep
tabDFLEref <- CompleteDFLEtable(tabref)
View(tabDFLEref)
tabproj <- tabproj %>%
filter(age %in% c( unique(tabref$age))) %>% ###
left_join(tabDFLEref[,c(vardim,varkeep)] , by = c(vardim) )
tabproj <- tabproj %>%
filter(age %in% c( unique(tabref$age)))
View(tabDFLEref)
varkeep
varkeep <- recode(hypo,
"cstDFLE" = "DFLEx",
"cstDLE" = "DLEx",
"cstPctDFLE" = "pctDFLEx",
"cstPrev" = "pix")
varkeep
hypo
hypo<-"cstDFLE"
varkeep <- recode(hypo,
"cstDFLE" = "DFLEx",
"cstDLE" = "DLEx",
"cstPctDFLE" = "pctDFLEx",
"cstPrev" = "pix")
varkeep
tabDFLEref <- CompleteDFLEtable(tabref)
# forecasted prevalences
tabproj <- tabproj %>%
filter(age %in% c( unique(tabref$age))) %>% ###
left_join(tabDFLEref[,c(vardim,varkeep)] , by = c(vardim) )
tabDFLEproj <- CompleteDFLEtable( tabproj )
View(tabDFLEproj)
View(tabref)
View(tabproj)
View(tabproj)
View(tabref)
tabDFLEproj <- CompleteDFLEtable( tabproj )
View(tabDFLEproj)
View(tabref)
View(tabproj)
View(tabproj)
View(tabDFLEproj)
load_all()
tabDFLEref <- CompleteDFLEtable(tabref)
# forecasted prevalences
tabproj <- tabproj %>%
filter(age %in% c( unique(tabref$age))) %>% ###
left_join(tabDFLEref[,c(vardim,varkeep)] , by = c(vardim) )
tabDFLEproj <- CompleteDFLEtable( tabproj )
View(tabDFLEproj)
tabDFLEref <- CompleteDFLEtable(tabref)
tabproj <- tabproj %>%
filter(age %in% c( unique(tabref$age))) %>% ###
left_join(tabDFLEref[,c(vardim,varkeep)] , by = c(vardim) )
View(tabproj)
projections <- prevalenceForecast( qmortref, qmortproj , input$optionProj,
includevars  = c("MeanDAx","MedianDAx","ModalDAx")) %>%
select(sex,age,year,ex,DFLEx,DLEx,pctDFLEx,pix,MeanDAx,MedianDAx,ModalDAx)
projections <- prevalenceForecast( qmortref, qmortproj , "cstDFLE",
includevars  = c("MeanDAx","MedianDAx","ModalDAx")) %>%
select(sex,age,year,ex,DFLEx,DLEx,pctDFLEx,pix,MeanDAx,MedianDAx,ModalDAx)
projections <- prevalenceForecast( qmortref, qmortproj , "cstDFLE",
includevars  = c("MeanDAx","MedianDAx","ModalDAx"))
tabref<- qmortref
tabproj <-qmortproj
vardim <- intersect( c("sex","age","categ") , intersect(names(tabref), names(tabproj)) )
varkeep <- recode(hypo,
"cstDFLE" = "DFLEx",
"cstDLE" = "DLEx",
"cstPctDFLE" = "pctDFLEx",
"cstPrev" = "pix")
# DFLE, DLE and pctDFLE for reference year
tabDFLEref <- CompleteDFLEtable(tabref)
View(tabDFLEref)
tabproj <- tabproj %>%
filter(age %in% c( unique(tabref$age))) %>% ###
left_join(tabDFLEref[,c(vardim,varkeep)] , by = c(vardim) )
View(tabproj)
tabDFLEproj <- CompleteDFLEtable( tabproj )
View(tabDFLEproj)
View(tabDFLEproj)
load_all()
tabDFLEproj <- CompleteDFLEtable( tabproj )
View(tabDFLEproj)
projections <- prevalenceForecast( qmortref, qmortproj , "cstDFLE",
includevars  = c("MeanDAx","MedianDAx","ModalDAx")) %>%
select(sex,age,year,ex,DFLEx,DLEx,pctDFLEx,pix,MeanDAx,MedianDAx,ModalDAx)
runApp('inst/shiny-examples/projprevalence')
runApp('inst/shiny-examples/projprevalence')
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
runExample()
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
sessionInfo()
install()
check()
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
install.packages("rsconnect")
install.packages("rsconnect")
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
Y
install.packages("shiny")
shiny::runApp('inst/shiny-examples/projprevalence')
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
runApp('inst/shiny-examples/projprevalence')
rsconnect::appDependencies()
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
build()
options('repos')
build_package()
library(devtools)
options('repos')
build()
options('repos')
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
devtools::install_github()
sessionInfo()
devtools::install()
rsconnect::getAccountInfo()
setRepositories("https://github.com/patrickaubert/healthexpectancies")
setRepositories("https://github.com/patrickaubert/")
options("repos")
?setRepositories
setRepositories(addURLs="https://github.com/patrickaubert/")
setRepositories(addURLs="https://github.com/")
options("repos")
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
load_all()
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
rsconnect::deployApp(appDir = "C:/Users/PA/Documents/R/Projets/healthexpectancies/inst/shiny-examples/projprevalence", server = "shinyapps.io")
library(devtools)
load_all()
library(devtools)
library(readxl)
library(tidyverse)
view(FRInseeMortalityrates)
max(FRInseeMortalityrates$year)
qmort_t69 <- bind_rows(
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
library(openxlsx)
qmort_t69 <- bind_rows(
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
View(qmort_t69)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,age) %>% group_by(year,sex) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
qmort_t69 <- bind_rows(
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
# correction pour tenir compte du fait qu'il s'agit de l'âge atteint en fin d'année => on considère que les décès à l'âge A au 31/12 se répartissent pour moitié entre les âges A-1 et 1 en année révolue
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(qx=qx/2,age=pmax(0,age-1)),
qmort_t69 %>% mutate(qx=qx/2)
) %>%
group_by(year,sex,age) %>% summarise_all(sum) %>% ungroup()
# ajout des quotients de mortalité pour l'ensemble des sexes, en faisant l'hypothèse d'un partage 50/50 d'hommes et de femmes à la naissance
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,age) %>% group_by(year,sex) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
qmort_t69 <- bind_rows(
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
# correction pour tenir compte du fait qu'il s'agit de l'âge atteint en fin d'année => on considère que les décès à l'âge A au 31/12 se répartissent pour moitié entre les âges A-1 et 1 en année révolue
qmort_t69_bis <- bind_rows(
qmort_t69 %>% mutate(qx=qx/2,age=pmax(0,age-1)),
qmort_t69 %>% mutate(qx=qx/2)
) %>%
group_by(year,sex,age) %>% summarise_all(sum) %>% ungroup()
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(def.age = "age at end of year"),
qmort_t69_bis %>% mutate(def.age = "current age (approx)")
)
View(qmort_t69)
qmort_t69 <- bind_rows(
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
sheet =  "qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
# correction pour tenir compte du fait qu'il s'agit de l'âge atteint en fin d'année => on considère que les décès à l'âge A au 31/12 se répartissent pour moitié entre les âges A-1 et 1 en année révolue
qmort_t69_bis <- bind_rows(
qmort_t69 %>% mutate(qx=qx/2,age=pmax(0,age-1)),
qmort_t69 %>% mutate(qx=qx/2)
) %>%
group_by(year,sex,age) %>% summarise_all(sum) %>% ungroup()
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(def.age = "age at end of year"),
qmort_t69_bis %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
View(qmort_t69_all)
View(qmort_t69_all)
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,def.age,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
View(qmort_t69_all)
View(qmort_t69_all)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
usethis::use_data(FRInseeMortalityForecast2016,
FRInseePopulationForecast2016,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
url_t69 <- "https://www.insee.fr/fr/statistiques/fichier/6036439/fe_dod_quotients_mortalite.xlsx"
qmort_t69 <- bind_rows(
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-F", #"qmortf",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "female"),
read.xlsx(
#xlsxFile = "data-raw/fe_dod_quotients_mortalite.xlsx",
xlsxFile = url_t69,
sheet = "Qmort-H", #"qmorth",
startRow = 5,
colNames = TRUE, skipEmptyRows = TRUE, skipEmptyCols = TRUE) %>%
filter(grepl("^[[:digit:]]{4}",Année)) %>%
pivot_longer(cols=-"Année",names_to="age",values_to="qx") %>%
mutate(sex = "male")
) %>%
rename(year=Année) %>%
mutate(age = str_extract(age,"^[[:digit:]]+") %>% as.numeric(),
year= as.numeric(year),
qx = qx/100000)
View(qmort_t69_bis)
View(qmort_t69)
View(qmort_t69)
qmort_t69_bis <- bind_rows(
qmort_t69 %>% mutate(qx=qx/2,age=pmax(0,age-1)),
qmort_t69 %>% mutate(qx=qx/2)
) %>%
group_by(year,sex,age) %>% summarise_all(sum) %>% ungroup()
qmort_t69 <- bind_rows(
qmort_t69 %>% mutate(def.age = "age at end of year"),
qmort_t69_bis %>% mutate(def.age = "current age (approx)")
) %>%
mutate(def.age = as.factor(def.age))
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,def.age,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
qmort_t69_all <- qmort_t69 %>%
mutate(qx=1-qx) %>%
arrange(year,sex,def.age,age) %>% group_by(year,sex,def.age) %>% mutate(qx=cumprod(qx)) %>% ungroup() %>%
select(-sex) %>% group_by(year,def.age,age) %>% summarise_all(mean) %>% ungroup()
qmort_t69_all <- qmort_t69_all %>%
left_join(qmort_t69_all %>% mutate(age=age+1) %>% rename(lqx=qx), by=c("year","age","def.age")) %>%
mutate(qx = ifelse(age==0,1-qx,1-qx/lqx),
sex = "all") %>%
select(-lqx)
qmort_t69 <- bind_rows( qmort_t69 , qmort_t69_all)
FRInseeMortalityrates_t69 <- qmort_t69
View(FRInseeMortalityrates_t69)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseePopulationForecast2016,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRDreesVQSsurvey2014,
FRDreesAPA2017,
FRDreesAPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
document()
view(FRGaliEUSilc)
document()
