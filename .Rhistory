prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout"),
X2 = paste0(X2," : ",X3)) %>%
select(-X3)
View(prev_vqs_2021_)
names(FRDreesVQSsurvey2014)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
select(-X1) %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
rename(limitationtype=X2,
limitationintensity=X3)
View(prev_vqs_2021_)
unique(prev_vqs_2021_$age)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
select(-X1) %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\+)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
freq(prev_vqs_2021_$agebracket)
unique(prev_vqs_2021_$agebracket)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
select(-X1) %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
unique(prev_vqs_2021_$agebracket)
View(prev_vqs_2021_)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
select(-X1) %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
View(prev_vqs_2021_)
eff_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_effectifs",
rows=c(4:129))
View(eff_vqs_2021)
names(eff_vqs_2021)[4:ncol(eff_vqs_2021)]  <- names(prev_vqs_2021)[4:ncol(prev_vqs_2021)]
View(eff_vqs_2021)
prev_vqs_2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
left_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb"),
by=c("X1","X2","X3","age")
) %>%
select(-X1) %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
prev_vqs_2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
left_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb"),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
filter(!is.na(prevalence)) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
View(prev_vqs_2021)
prev_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_parts",
rows=c(4:129))
eff_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_effectifs",
rows=c(4:129))
# names of columns
nb_age <- (ncol(prev_vqs_2021)-3)/3
names(prev_vqs_2021)[4:ncol(prev_vqs_2021)] <- paste0(
c(rep("male",nb_age),rep("female",nb_age),rep("all",nb_age)),
"_",names(prev_vqs_2021)[4:ncol(prev_vqs_2021)])
names(eff_vqs_2021)[4:ncol(eff_vqs_2021)]  <- names(prev_vqs_2021)[4:ncol(prev_vqs_2021)]
prev_vqs_2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
left_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb"),
by=c("X1","X2","X3","sex_age")
)
prev_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_parts",
rows=c(4:129))
eff_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_effectifs",
rows=c(4:129))
# names of columns
nb_age <- (ncol(prev_vqs_2021)-3)/3
names(prev_vqs_2021)[4:ncol(prev_vqs_2021)] <- paste0(
c(rep("male",nb_age),rep("female",nb_age),rep("all",nb_age)),
"_",names(prev_vqs_2021)[4:ncol(prev_vqs_2021)])
names(eff_vqs_2021)[4:ncol(eff_vqs_2021)]  <- names(prev_vqs_2021)[4:ncol(prev_vqs_2021)]
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence") %>%
left_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb"),
by=c("X1","X2","X3","sex_age")
)
View(prev_vqs_2021_)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence))
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
left_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence))
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
)
prev_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_parts",
rows=c(4:129))
eff_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_effectifs",
rows=c(4:129))
# names of columns
nb_age <- (ncol(prev_vqs_2021)-3)/3
names(prev_vqs_2021)[4:ncol(prev_vqs_2021)] <- paste0(
c(rep("male",nb_age),rep("female",nb_age),rep("all",nb_age)),
"_",names(prev_vqs_2021)[4:ncol(prev_vqs_2021)])
names(eff_vqs_2021)[4:ncol(eff_vqs_2021)]  <- names(prev_vqs_2021)[4:ncol(prev_vqs_2021)]
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
)
prev_vqs_2021_ <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
View(prev_vqs_2021_)
FRDreesVQSsurvey2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
View(FRDreesVQSsurvey2021)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesVQSsurvey2021,
FRDreesAPA2017,
FRDreesAPA,
FRDreesEHPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
View(FRDreesVQSsurvey2021)
document()
dfle2021 <- FRInseeMortalityrates_t69
View(dfle2021)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)")
View(dfle2021)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
View(dfle2021)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-def.age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
View(dfle2021)
dfle2021 <- dfle2021 %>% left_join(FRDreesVQSsurvey2021, by=c("sex","agebracket"))
View(dfle2021)
prev_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_parts",
rows=c(4:129))
eff_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_effectifs",
rows=c(4:129))
# names of columns
nb_age <- (ncol(prev_vqs_2021)-3)/3
names(prev_vqs_2021)[4:ncol(prev_vqs_2021)] <- paste0(
c(rep("male",nb_age),rep("female",nb_age),rep("all",nb_age)),
"_",names(prev_vqs_2021)[4:ncol(prev_vqs_2021)])
names(eff_vqs_2021)[4:ncol(eff_vqs_2021)]  <- names(prev_vqs_2021)[4:ncol(prev_vqs_2021)]
FRDreesVQSsurvey2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",(str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)")+1),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
FRDreesVQSsurvey2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") ) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",(as.numeric(str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"))+1),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
View(FRDreesVQSsurvey2021)
usethis::use_data(FRInseeMortalityForecast2016,
FRInseeMortalityForecast2021,
FRInseeMortalityrates,
FRInseeMortalityrates_t69,
FRInseePopulation,
FRInseePopulationForecast2016,
FRInseePopulationForecast2021,
FRDreesVQSsurvey2014,
FRDreesVQSsurvey2021,
FRDreesAPA2017,
FRDreesAPA,
FRDreesEHPA,
FRGaliEUSilc,
sullivan,
description_sullivan,
overwrite = T)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-def.age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
dfle2021 <- dfle2021 %>% left_join(FRDreesVQSsurvey2021, by=c("sex","agebracket"))
View(dfle2021)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-def.age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
dfle2021 <- dfle2021 %>% left_join(FRDreesVQSsurvey2021, by=c("sex","agebracket")) %>% arrange(sex,limitationtype,limitationintensity,age)
View(dfle2021)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-def.age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
dfle2021 <- dfle2021 %>% left_join(FRDreesVQSsurvey2021, by=c("sex","agebracket")) %>% arrange(sex,limitationtype,limitationintensity,age) %>% select(-nb,-agebracket)
View(dfle2021)
View(dfle2021)
dfle2021 <- CompleteDFLEtable(dfle2021, categories=c("limitationtype","limitationintensity"))
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-def.age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
dfle2021 <- dfle2021 %>% left_join(FRDreesVQSsurvey2021, by=c("sex","agebracket")) %>% arrange(sex,limitationtype,limitationintensity,age) %>% select(-nb,-agebracket) %>% rename(pix=prevalence)
dfle2021 <- CompleteDFLEtable(dfle2021, categories=c("limitationtype","limitationintensity"))
View(dfle2021)
names(dfle2021)
dfle2021 <- CompleteDFLEtable(dfle2021, categories=c("limitationtype","limitationintensity"))
View(dfle2021)
unique(dfle2021$limitationtype)
unique(dfle2021$limitationintensity)
truc <- dfle2021 %>% filter(is.na(limitationtype))
View(truc)
unique(dfle2021$agebracket)
unique(FRDreesVQSsurvey2021$agebracket)
FRDreesVQSsurvey2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") %>%
recode())
names(prev_vqs_2021)
prev_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_parts",
rows=c(4:129))
eff_vqs_2021 <- read.xlsx(xlsxFile="https://data.drees.solidarites-sante.gouv.fr/api/datasets/1.0/enquete-vie-quotidienne-et-sante-2021-donnees-detaillees/attachments/enquete_vie_quotidienne_et_sante_2021_donnees_nationales_xlsx/",
sheet="Données nationales_effectifs",
rows=c(4:129))
# names of columns
nb_age <- (ncol(prev_vqs_2021)-3)/3
names(prev_vqs_2021)[4:ncol(prev_vqs_2021)] <- paste0(
c(rep("male",nb_age),rep("female",nb_age),rep("all",nb_age)),
"_",names(prev_vqs_2021)[4:ncol(prev_vqs_2021)])
names(eff_vqs_2021)[4:ncol(eff_vqs_2021)]  <- names(prev_vqs_2021)[4:ncol(prev_vqs_2021)]
FRDreesVQSsurvey2021 <- prev_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="prevalence")  %>%
filter(!is.na(prevalence)) %>%
full_join(
eff_vqs_2021 %>%
fill(all_of(c("X1","X2","X3")), .direction="down") %>%
pivot_longer(cols = -c("X1","X2","X3"),names_to="sex_age",values_to="nb")  %>%
filter(!is.na(nb)),
by=c("X1","X2","X3","sex_age")
) %>%
select(-X1) %>%
mutate(prevalence= prevalence/100,
sex = sex_age %>% str_extract("^[^_]+(?=_)"),
age = sex_age %>% str_replace("^[^_]+_","") %>%
recode("74-79.ans"="75-79.ans")) %>%
select(-sex_age) %>%
#filter(!(X3 %in% c("Non","Aucune","Très bon","Bon","Assez bon"))) %>%
mutate(X3 = X3 %>% str_replace("^N.+ pas du tout","Ne peut pas du tout")) %>%
mutate(agebracket = case_when(
age == "Total" ~ "[5,Inf)",
age == "85.ans.et.plus" ~ "[85,Inf)",
TRUE ~ paste0("[",str_extract(age,"^[[:digit:]]+(?=\\-)"),",",(as.numeric(str_extract(age,"(?<=\\-)[[:digit:]]+(?=\\.)"))+1),")") ),
agebracket = factor(agebracket)) %>%
select(-age) %>%
rename(limitationtype=X2,
limitationintensity=X3)
usethis::use_data(FRDreesVQSsurvey2021, overwrite = T)
dfle2021 <- FRInseeMortalityrates_t69 %>% filter(year==2021 & def.age=="current age (approx)" & age>=5) %>% select(-def.age) %>% mutate(agebracket=cut(age,breaks=c(seq(5,85,5),Inf),include_lowest=TRUE,right=FALSE))
dfle2021 <- dfle2021 %>% left_join(FRDreesVQSsurvey2021, by=c("sex","agebracket")) %>% arrange(sex,limitationtype,limitationintensity,age) %>% select(-nb,-agebracket) %>% rename(pix=prevalence)
unique(dfle2021$limitationtype)
unique(dfle2021$limitationintensity)
dfle2021 <- CompleteDFLEtable(dfle2021, categories=c("limitationtype","limitationintensity"))
View(dfle2021)
View(dfle2021)
dfle2021 %>% filter(age==60) %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") + coord_flip() + labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
View(dfle2021)
dfle2021 %>% filter(age==60) %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") +  + labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
dfle2021 %>% filter(age==60) %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") +  labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
View(dfle2021)
dfle2021 %>% filter(age==60 & sex=="all") %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") +  labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
dfle2021 %>% filter(age==60 & sex=="all") %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") + coord_flip() + labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
View(dfle2021)
dfle2021 %>% filter(age==60 & sex=="all" & grepl("^Difficultés",limitationtype) & limitationintensity!="Non") %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") + coord_flip() + labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
dfle2021 %>% filter(age==60 & sex=="all" & grepl("^Difficultés",limitationtype) & limitationintensity!="Aucune") %>% ggplot(aes(y=DLEx,x=limitationtype,fill=limitationintensity)) + geom_bar(stat="identity",position="stack") + coord_flip() + labs(title="Espérance de vie avec ou sans incapacité à 60 ans")
View(dfle2021)
unique(dfle2021$limitationtype)
usethis::use_data(FRDreesVQSsurvey2021, overwrite = T)
document()
